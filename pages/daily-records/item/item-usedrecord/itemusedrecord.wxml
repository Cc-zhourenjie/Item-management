<!--pages/daily-records/item/item-usedrecord/itemusedrecord.wxml-->
<view class="container">
    <!-- 搜索和筛选区域 -->
    <view class="search-section">
        <input class="search-input" placeholder="输入物品名称" />
        <button class="filter-btn">物品分类</button>
        <button class="search-btn">搜索</button>
    </view>

    <!-- 日历导航 -->
    <view class="calendar-nav">
        <button class="nav-btn prev-btn" bindtap="prevMonth">‹</button>
        <text class="month-text">{{currentYear}}年{{currentMonth}}月</text>
        <button class="nav-btn next-btn" bindtap="nextMonth">›</button>
    </view>

    <!-- 日历网格 -->
    <view class="calendar-container">
        <!-- 星期标题 -->
        <view class="week-header">
            <text class="week-day">一</text>
            <text class="week-day">二</text>
            <text class="week-day">三</text>
            <text class="week-day">四</text>
            <text class="week-day">五</text>
            <text class="week-day weekend">六</text>
            <text class="week-day weekend">日</text>
        </view>

        <!-- 日期网格 -->
        <view class="calendar-grid">
            <view
                class="calendar-day {{item.isCurrentMonth ? 'current-month' : 'other-month'}} {{item.isToday ? 'today' : ''}} {{item.isWeekend ? 'weekend' : ''}} {{item.isSelected ? 'selected' : ''}} {{(item.isCurrentMonth && item.records && item.records.length > 0) ? 'has-records' : ''}}"
                wx:for="{{calendarDays}}" wx:key="index" bindtap="selectDate" data-date="{{item.date}}">
                <text class="day-number">{{item.day}}</text>
                <view class="day-records" wx:if="{{item.isCurrentMonth && item.records && item.records.length > 0}}">
                    <view class="record-tag" wx:for="{{item.visibleRecords}}" wx:for-item="record" wx:key="index"
                        style="background-color: {{record.color}}">
                        <text class="record-name">{{record.item_name}}</text>
                        <text class="record-amount">{{record.item_price}}</text>
                    </view>
                    <text class="more-records" wx:if="{{item.hiddenCount > 0}}">
                        等{{item.hiddenCount}}个...
                    </text>
                </view>
                <text class="no-records" wx:elif="{{item.isCurrentMonth}}">无</text>
            </view>
        </view>
    </view>


    <!-- 使用记录列表 -->
    <scroll-view class="records-list" scroll-y>
        <view class="list-header">
            <text class="summary-title">本月使用记录</text>
            <text class="total-amount">消费总额: ¥{{costTotal}}</text>
        </view>
        <view class="native-card-container">
            <view class="native-card" wx:for="{{usageRecords}}" wx:key="index">
                <view class="card-content">
                    <image class="card-thumb"
                        src="http://127.0.0.1:10020/api/oss/file/browse/browse/{{item.item_picture}}" mode="aspectFill"
                        data-index="{{index}}" bindload="onThumbLoad" binderror="onThumbError" bindtap="onPreviewImage">
                    </image>
                    <view class="card-info" data-index="{{index}}" bindtap="onCardClick">
                        <view class="card-title">{{item.item_name}}</view>
                        <view class="card-desc" wx:if="{{item.item_state != '-1'}}">
                            使用数量: {{item.used_volume}}{{item.item_number_unit_bak}}
                        </view>
                        <view class=" card-desc">
                            {{item.used_date}}
                        </view>
                    </view>
                </view>
            </view>
        </view>
    </scroll-view>
</view>